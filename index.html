<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>Canvas tutorial</title>
    <script type="text/javascript">
        Snake = {
            ctx: null,
            canvas: null,
            boardSize: 20,
            tileSize: 20,
            snakeCoordinates: [],
            moveDirection: 'up',
            speed: 5,
            food: {
                x: 0,
                y: 0
            },
            init: function () {
                this.canvas = document.getElementById('snake-canvas');
                if (!this.canvas.getContext) {
                    return;
                }

                let sceneSize = this.boardSize * this.tileSize;

                this.canvas.width = sceneSize;
                this.canvas.height = sceneSize;

                this.ctx = this.canvas.getContext('2d');



                this.snakeCoordinates.push({
                    x: 12,
                    y: 21
                }, {
                    x: 12,
                    y: 22
                }, {
                    x: 12,
                    y: 23
                }, {
                    x: 12,
                    y: 24
                });

                document.onkeydown = (e) => {
                    e = e || window.event;

                    if (e.keyCode === 38) {
                        if (this.moveDirection !== 'down') {
                            this.moveDirection = 'up';
                        }
                    } else if (e.keyCode === 40) {
                        if (this.moveDirection !== 'up') {
                            this.moveDirection = 'down';
                        }
                    } else if (e.keyCode === 37) {
                        if (this.moveDirection !== 'right') {
                            this.moveDirection = 'left';
                        }
                    } else if (e.keyCode === 39) {
                        if (this.moveDirection !== 'left') {
                            this.moveDirection = 'right';
                        }
                    }
                };

                this.updateFood();
                this.renterBoard();

                setInterval(() => {
                    this.moveSnake();
                    this.renterBoard();
                }, 500 / this.speed);


            },
            updateFood() {
                let freeCellsCount = Math.pow(this.boardSize, 2) - this.snakeCoordinates.length;
                let randomCellNumber = Math.floor(Math.random() * freeCellsCount);

                let i = 0;
                for (let x = 0; x < this.boardSize && i <= randomCellNumber; x++) {
                    for (let y = 0; y < this.boardSize && i <= randomCellNumber; y++) {
                        if (this.snakeCoordinates.find(c => c.x === x && c.y === y) !== undefined) {
                            continue;
                        }

                        if (randomCellNumber === i) {
                            this.food.x = x;
                            this.food.y = y;
                        }

                        i = i + 1;
                    }
                }
            },
            moveSnake() {
                let head = this.snakeCoordinates[0],
                    tail = Object.assign({}, head);

                this.snakeCoordinates.splice(this.snakeCoordinates.length - 1, 1);

                switch (this.moveDirection) {
                    case 'up':
                        tail.y = (head.y === 0 ? this.boardSize : head.y) - 1;
                        break;
                    case 'down':
                        tail.y = (head.y === this.boardSize - 1 ? 0 : head.y) + 1;
                        break;
                    case 'left':
                        tail.x = (head.x === 0 ? this.boardSize : head.x) - 1;
                        break;
                    case 'right':
                        tail.x = (head.x === this.boardSize - 1 ? 0 : head.x) + 1;
                        break;
                }

                this.snakeCoordinates.unshift(tail);

                if (this.samePoint(this.food, tail)) {
                    this.feedSnake();
                    this.updateFood();
                }
            },
            feedSnake: function () {
                let head = this.snakeCoordinates[0],
                    tail = Object.assign({}, this.food);

                switch (this.moveDirection) {
                    case 'up':
                        tail.y = (head.y === 0 ? this.boardSize : head.y) - 1;
                        break;
                    case 'down':
                        tail.y = (head.y === this.boardSize - 1 ? 0 : head.y) + 1;
                        break;
                    case 'left':
                        tail.x = (head.x === 0 ? this.boardSize : head.x) - 1;
                        break;
                    case 'right':
                        tail.x = (head.x === this.boardSize - 1 ? 0 : head.x) + 1;
                        break;
                }

                this.snakeCoordinates.unshift(tail);
            },
            samePoint: function (a, b) {
                return a.x === b.x && a.y === b.y;
            },
            renterBoard: function () {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);

                for (let x = 0; x < this.boardSize; x++) {
                    for (let y = 0; y < this.boardSize; y++) {
                        this.ctx.strokeRect(x * this.tileSize, y * this.tileSize, this.tileSize, this.tileSize);
                    }
                }

                for (let i = 0; i < this.snakeCoordinates.length; i++) {
                    this.pointOn(this.snakeCoordinates[i].x, this.snakeCoordinates[i].y);
                }

                this.pointOn(this.food.x, this.food.y);
            },
            pointOn: function (x, y) {
                this.ctx.fillRect(x * this.tileSize, y * this.tileSize, this.tileSize, this.tileSize);
            },
            clearPoint: function (x, y) {
                this.ctx.clearRect((x * this.tileSize) + 1, (y * this.tileSize) + 1, this.tileSize - 2, this.tileSize - 2);
            }
        };
    </script>
    <style type="text/css">
        body {
            margin: 0;
            padding: 0;
        }
        canvas {
            border: 1px solid black;
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            margin: auto;
        }
    </style>
</head>
<body onload="Snake.init()">
<canvas id="snake-canvas"></canvas>
</body>
</html>